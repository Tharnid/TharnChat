var _ = require('underscore');
var EventEmitter = require('events').EventEmitter;
var net = require('net');

var chatty = {
	createServer: function(config) {
		
		var emitter = new EventEmitter();
		var onSocketConnnection = function(socket) {
			emitter.emit('client connected', socket);
		};

		return {
			on: function(event, fn)
			{
				emitter.on(event, fn);
			},

			start: function ()
			{
				if(config.httpServer != null)
				{
					var io = require('socket.io').listen(config.httpServer);

					io.sockets.on('connection', onSocketConnnection);

					if(config.tcpHost != null && config.tcpPort != null)
					{
						var server = net.Server();

						server.on('connection', onSocketConnnection);
						server.listen(config.tcpPort, config.tcpHost);
					}
				}
			}
		}
	}
};

module.exports = chatty;